<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE set SYSTEM "docbook/docbookx.dtd" [

	<!ENTITY productname "Very Quick Wiki">

	<!ENTITY productversion "2.7.1">

	<!ENTITY docversion "0.5.0">

	<!ENTITY copyright-year "2002-2004">

	<!ENTITY pubdate "2004">

]>
<set>
	
	<book vendor="veryquickwiki.sourceforge.net">
		
		<bookinfo>
			<title>
				&productname; Version-&productversion; Administrator's Manual
			</title>
			
			<author>
				<firstname>Gareth</firstname>
				<surname>Cronin</surname>
			</author>
			
			<copyright>
				
				<year>&copyright-year;</year>
				
				<holder>
					Gareth Cronin, Auckland, New Zealand
				</holder>
			
			</copyright>
			<releaseinfo>
				<remark>
				VeryQuickWiki can be downloaded from
				<ulink url="http://veryquickwiki.sourceforge.net/">http://veryquickwiki.sourceforge.net/</ulink>.&nbsp;&nbsp;
				This application is a work in progress - contributions and corrections
				are welcome and may be sent
				to:<email><ulink url="garethc@users.sourceforge.net"/>
					</email>
				</remark>
			</releaseinfo>
		
		</bookinfo>
		
		<preface>
			
			<title>Preface</title>
			
			<para>

					This manual is intended for installers and administrators of VQWiki.&nbsp;&nbsp;It may 
					also be of use to end users as it provides further detail about advanced functions of VQWiki.

				</para>
			
			<para>

					This manual is presented using DocBook<footnote>

						<para>DocBook at Oasis <ulink url="http://www.oasis-open.org/docbook/">http://www.oasis-open.org/docbook/</ulink>
					
					</para>
				
				</footnote> - the open XML standard for technical writing - and is rendered to presentation formats using the XSL from the DocBook Open Repository Project<footnote>

						<para>DocBook Open Repository <ulink url="http://docbook.sourceforge.net/">http://docbook.sourceforge.net/</ulink>
					
					</para>
				
				</footnote>
			
			</para>
		
		
		</preface>
		<chapter>
			
			<title>Introduction</title>
			<para>
				<ulink url="http://c2.com/cgi/wiki?WikiHistory">Wiki</ulink>  
					is software that allows users to create and edit Web page content using a Web browser.
					&nbsp; &nbsp; As a collaboration tool, Wiki is unusual in that it allows the organization of content
					to be edited in addition to the content itself.&nbsp; &nbsp;
					You can learn more about Wiki usage at <ulink url="http://www.wiki.org/wiki.cgi?WhatIsWiki">http://www.wiki.org/wiki.cgi?WhatIsWiki</ulink>.
					&nbsp;&nbsp;The etymology of Wiki is described <ulink url="http://c2.com/cgi/wiki?EtymologyOfWiki">here</ulink>.
					
				</para>
			
			<para>	"Very Quick Wiki" or "VQWiki" is a Wiki engine written using JSPs and servlets and is designed to run on Tomcat
					or any servlet container that supports Java Servlet 2.3 and JSP 1.2 specifications.  &nbsp;&nbsp;
					Gareth Cronin is the original developer of the VQWiki.&nbsp; &nbsp;
					Thanks to the contributions of many, VQWiki has undergone numerous improvements.&nbsp;&nbsp;
					VQWiki supports hyperlinks, topic or text-based searching, email notifications, and utilizes 
					a simple but powerful text syntax for creating topics and editing their content.&nbsp;&nbsp;
					The first Wiki engine was developed in 1995 by Ward Cunningham. 
					Since then many <ulink url="http://c2.com/cgi/wiki?WikiEngines">Wiki engines</ulink>, such as 
					VQWiki,  have been developed.
										
				</para>
			
			<formalpara>
				
				<title>Conventions Used in this Manual</title>
				
				<para>

					As with any manual, there are a number of abbreviations you should be aware of.

					<table>

						<title>Conventions</title>
						
						<tgroup cols="2">
							
							<tbody>

								
								
								<row>
									
									<entry>
										
										<systemitem>{$TOMCAT_HOME}</systemitem>
									
									</entry>
									
									<entry>The directory where Tomcat (or other application server) is installed.</entry>
								
								</row>
								
								<row>
									
									<entry>
										
										<systemitem>{wikiurl}</systemitem>
									
									</entry>
									
									<entry>The base URL for accessing VQWiki, e.g. <systemitem>http://localhost:8080/jmwiki-&productversion;</systemitem>.
									&nbsp;&nbsp;With a WAR name of "jmwiki-&productversion;.war", the default local URL for Tomcat will be
									http://localhost:8080/jmwiki-&productversion;


									</entry>
								
								</row>
								
								
								<row>
									
									<entry>
										
										<systemitem>{wikihome}</systemitem>
									
									</entry>
									
									<entry>The wiki file system home. For users of the Microsoft Windows operating system, the wiki file system home is located at  C:\WINDOWS\SYSTEM32\CONFIG\systemprofile\wiki 

									</entry>
								
								</row>
							
							
							</tbody>
						
						</tgroup>
					
					</table>
				
				</para>
			
			</formalpara>
		</chapter>
		
		
		<chapter>
			
			<title>Installation</title>
			
			<section>
				<title>Preparing for the installation.</title>
				<para>
			You'll need a few things before attempting installation.
			
			<itemizedlist mark="opencircle">
				<listitem>
				  <para>
					A servlet container that supports Java Servlet 2.3 and JSP 1.2 specifications.&nbsp;&nbsp;
					VQWiki is tested with Apache Tomcat 4.1.24<footnote><para>Apache Tomcat <ulink url="http://jakarta.apache.org/tomcat">http://jakarta.apache.org/tomcat</ulink>
									</para>
								</footnote>
					&nbsp;&nbsp;
					Users have also reported successful implementation with the following servlet containers: JBoss/Jetty; JBoss/Tomcat 4.x,
					Orion 1.6, Resin 2.1.9, Allaire JRun 4.x, BEA Weblogic 7.x, IBM Websphere 5, Oracle 9i Application Server. &nbsp;&nbsp;
					Note: Tomcat 3.x is not recommended for use with VQWiki.
					</para>
						</listitem>
						<listitem>
							<para>
				        Any stable web browser such as Internet Explorer 6, Netscape 7.1, Mozilla 1.4 or Opera 7.11.
				  </para>
						</listitem>
						<listitem>
							<para>
				        Java SDK 1.3.1 or higher depending on the requirements of your servlet container.
					</para>
						</listitem>
						<listitem>
							<para>
					By default, VQWiki runs with flat-file persistence. But an easy to configure database connectivity option is available.
					</para>
						</listitem>
					
					</itemizedlist>
				</para>
			</section>
			<section>
				<title>Performing a first time installation.</title>
				
				<blockquote>
					<para>

				First-time installation should be very simple on any application server.
				Upgrading from an earlier version of VQWiki is a little more difficult, so we'll cover that later.

			</para>
					
					<para>

				VQWiki is designed to be a "drop and run" application. When you download VQWiki from a website, it will be available as a single "Web Archive File" or "WAR" for short. Most application servers (including Tomcat) are capable of automatically deploying an application directly from a WAR

			</para>
					
					<para>

				The following assumes you have installed Tomcat on a Windows machine at {$TOMCAT_HOME} and that it is running with the default stand-alone port 8080.
				We will also assume that the VQWiki WAR file is named <filename>jmwiki-&productversion;.war</filename>.&nbsp;&nbsp;
				The name of the WAR file may be different in which case you should substitute your WAR file name for jmwiki-&productversion;.war.&nbsp;&nbsp;
				Finally, we will assume you have a Web browser available on the installation machine.
			</para>
					
					<para>
				To install VQWiki, you should follow your application server instructions for deploying a WAR. Usually it's just a matter
				of plonking the WAR file into the webapps directory.
				Then browse to <systemitem>http://localhost:8080/jmwiki-&productversion;</systemitem>, and that's it!
			</para>
					<para>
				For example, if you are using Tomcat 4.x or higher, one method to deploy VQWiki is to take the following steps:
			</para>
					
					<orderedlist numeration="arabic">
						
						<listitem>
							
							<para>Shut down Tomcat if it is running.</para>
						
						</listitem>
						
						<listitem>
							
							<para>Move the downloaded WAR file (jmwiki-&productversion;.war) into the directory {$TOMCAT_HOME}/webapps</para>
						
						</listitem>
						
						<listitem>
							
							<para>Start Tomcat</para>
						
						</listitem>
						
						<listitem>
							
							<para>Browse to <systemitem>http://localhost:8080/jmwiki-&productversion;</systemitem>
							
							</para>
						
						</listitem>
					
					</orderedlist>
					
					<para>

				That's it!

			</para>
					
					<para>

				On the opening screen, you'll see a list of links - the first one listed is StartingPoints. 
				If you have never browsed to a Wiki topic on your installation before, choose StartingPoints to be 
				directed to a special page where you will receive a password for access to administrative functions.
				<emphasis>Memorize the password!</emphasis>. If you miss the password, or you forget it,
				see the section on password recovery later in this guide.
			</para>
					
					<para>

				By default, VQWiki runs with flat-file persistence and other default options.&nbsp;&nbsp;
				Choose the "Admin" link at the bottom of any topic to access administrative functions
				where you can customise VQWiki.&nbsp;&nbsp; In the chapters below we address setting up database persistence
				and other VQWiki options.

			</para>
				
				</blockquote>
			</section>
		
		</chapter>
		
		
		<chapter>
			
			<title>Wiki Functions</title>
			
			<para>

				This chapter will touch on the major mechanisms available in VQWiki. The more complex mechanisms receive their own chapters later on.

			</para>
			
			
			<formalpara>
				
				<title>Editing</title>
				
				<para>

					Any topic in a Wiki may be edited. The user clicks the "EditPage" link at the top or bottom of the page, makes changes,
					clicks the "Save" button and is redirected back to the page of the topic page that the user has edited.

				</para>
			
			</formalpara>
			<formalpara>
				
				<title>WikiNames</title>
				
				<para>
					A WikiName consists of two or more words with initial capitals, run together.
					A WikiName appears as a word in "CamelCaps".
					The syntax of a WikiName is a
					<blockquote>
					<para>Uppercase letter</para>
						<para>Lowercase letter(s)</para>
						<para>Uppercase letter</para>
						<para>Lowercase letter(s)</para>
					</blockquote>
					Examples of well-formed Wikinames are: WikiWord or GoodStyle. 					
					When you type a WikiName, you establish a hyperlink. It's as easy as that.
					VQWiki also allows topic-naming by surrounding a word or phrase in back-ticks, such as `Gareth Cronin`.
				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Linking</title>
				
				<para>
					
					When you edit a page by typing a WikiName, the WikiName will appear with a question mark (?) link appended to the end
					of the WikiName. &nbsp;&nbsp; Click the question mark.  &nbsp;&nbsp;You will then be  
					directed to the edit function mode of the page that will be identified by the WikiName you created.
					&nbsp;&nbsp;Save the page.  &nbsp;&nbsp;Now your WikiName will be displayed as a link to the new page any time the WikiName appears in the Wiki, thus 
					making your WikiName a hyperlink. &nbsp;&nbsp;It's as easy as that.
					
				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Searching</title>
				
				<para>

					Each page contains a text field for searching.  The search button performs a full-text search based on the text in the text field and returns a list of topics where the text is found.
					&nbsp;&nbsp;If more than one search term is entered, the topics are ordered by relevance, i.e. the topics where <emphasis>all</emphasis> of the search terms were found are shown first.
					&nbsp;&nbsp;A search can also be performed by clicking on the title of any topic - this searches for the topic name itself.

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Reserved Topics</title>
				
				<para>

					Some topic names are reserved for redirection to Wiki features. For example, the topic WikiSearch will send the user to the search page.

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Username Cookies</title>
				
				<para>

					By using the SetUsername reserved topic, a user can set a username for herself/himself.
					&nbsp;&nbsp;This function sends a cookie to the browser to identify the user in the future.
					&nbsp;&nbsp;Usernames are displayed in RecentChanges and are necessary for email notification.
					&nbsp;&nbsp;Wiki was never meant to be a secure, rights-based system, 
					&nbsp;&nbsp;Therefore, the support for auditing is very simplistic (a security extension is on the drawing board for future versions).
					

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>RecentChanges</title>
				
				<para>

					The RecentChanges reserved topic displays a list of recently altered topics, together with the date and time it was altered and the username of the person who altered it (or their IP address if they did not set a username).

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>File Upload and Attachment</title>
				
				<para>

					When writing Wiki topics it is often useful to be able to attach a file of some kind to the topic. A user can click the "Attach" link on any topic and be presented with a file upload page. Attached files can be referred to by a linking syntax (e.g. "att:myfile.txt"). VQWiki has its own MIME type mapping that can be customised to suit installations.

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Email Notification</title>
				
				<para>Users who have set usernames can register an email address and subscribe to topics. They are then notified by email when a topic they are interested in is changed.</para>
			
			</formalpara>
			
			<formalpara>
				<title>Virtual Wikis</title>
				<para>The last part of the VQWiki URL ("jsp" by default) is the name of a "virtual wiki". It is possible to set up as many virtual wikis as you like, each one with its own completely independent contents.
				 Instruction for creating a virtual wiki follows:
					<orderedlist numeration="arabic">
					<listitem><para>Access the admin console at {wikiurl}/jsp/admin.jsp</para>
						</listitem>
						<listitem>
							<para>Scroll down to the "add virtual wiki" box, enter a name (one word, no spaces) and click add</para>
						</listitem>
						<listitem>
							<para>Shut down Tomcat</para>
						</listitem>
						<listitem>
							<para>Edit {$TOMCAT_HOME}/webapps/jmwiki-&productversion;/WEB-INF/web.xml</para>
						</listitem>
						<listitem>
							<para>In web.xml you'll find a sample mapping and a comment for setting up a new Wiki servlet mapping.</para>
						</listitem>
						<listitem>
							<para>Add a mapping to the Wiki servlet using the same name as you chose in step 2 as the part
					of the URL after the base Wiki context. E.g. if your virtual wiki is called "other", the
					complete mapping will look like:
						 <blockquote><para>	&lt;servlet-mapping&gt;</para>
									<para>&lt;servlet-name&gt;Wiki&lt;/servlet-name&gt;</para>
									<para>&lt;url-pattern&gt;/other/Wiki&lt;/url-pattern&gt;</para>
									<para>&lt;/servlet-mapping&gt;</para>
								</blockquote>
							</para>
						</listitem>
						<listitem>
							<para>Set a "friendly name" for the virtual wiki in {$TOMCAT_HOME}/webapps/jmwiki-&productversion;/WEB-INF/classes/ApplicationResources.properties.
					The entry should be of the format:</para>
							<blockquote>
								<para>
					   virtualwiki.other.name=Other
					   Where "Other" is the name that will appear in the virtual wiki list.
						 </para>
							</blockquote>
						</listitem>
					</orderedlist>
				</para>
			</formalpara>
			
			<formalpara>
				
				<title>Templates</title>
				
				<para>

					Topics can be saved as templates. The template can then be appended to any topic. This allows for the creation of standard forms for input, such as requirements documents or contact details.

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Versioning</title>
				
				<para>

					Every change to a topic is written to a separate versioning copy. This acts as disaster-recovery and anti-vandalism backup and supports a "diff" facility, where the actual changes made to a topic can be identified. The history browser, accessible through the "History" link on the menu bar of each topic shows all the versions that exist.

				</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Read Only Topics</title>
				
				<para>Topics such as StartingPoints can be designated as read-only by the administrator.</para>
			
			</formalpara>
			
			<formalpara>
				
				<title>Default Topics</title>
				
				<para>Several topics are created by default the first time VQWiki is run, or when a new virtual wiki is accessed. These are TextFormattingRules (a description of the markup available by default), FritzTextFormattingRules (a description of the markup available in one of the other shipped lexers) and StartingPoints (a default start page).</para>
			
			</formalpara>
		
		</chapter>

		
		
		<chapter>
			<title>The Admin Console</title>
			<para>
				The admin console is protected by a password that is shown to the first person to browse to a Wiki topic after installation. The admin username is "admin". If you have lost your password see the section on password recovery below.
			</para>
			<para>
				At the bottom of any Wiki topic you will see the version of VQWiki you are using and an "Admin" link. Click this link.
			</para>
			<para>
				After you have logged in (username "admin"), you will find yourself looking at a list of text fields and check boxes, each representing some customisable feature of the Wiki. We'll present a table of these settings and refer you on to those that need their own chapters for further explanation.
			</para>
			<table>
				<title>Admin Console Settings</title>
				<tgroup cols="2">
					<tbody>
						<row>
							<entry>Editing lock time-out</entry>
							<entry>The number of minutes that a user can edit a topic for exclusively. After this time out, another user may begin to edit the topic, and should this occur, the user whose edit timed-out will have to redo their changes.</entry>
						</row>
						<row>
							<entry>Number of days of RecentChanges</entry>
							<entry>The number of days back from the present day to display changes made in the RecentChanges list</entry>
						</row>
						<row>
							<entry>Maximum number of backlinks</entry>
							<entry>At the bottom of every page a list of links to topics that link to the current topic is displayed. If the topic is mentioned often, this list can grow very large. The maximum backlink limit keeps this list to the specified number. If the number is exceeded, a "..." appears after the list. A user can always check on all the backlinks by clicking on the topic title to perform a search on the title term.</entry>
						</row>
						<row>
							<entry>Automatic index interval</entry>
							<entry>In the default flat-file mode, the search index is updated every time a topic is altered, this picks up any additions to topics, however it does not account for removal of terms that have been deleted from topic text. A periodic sweep of the text needs to be made to account for deletions. This interval is the amount of time between sweeps. 24 hours should really be sufficient, due to the fact that Wiki is by nature additive rather than subtractive.</entry>
						</row>
						<row>
							<entry>New line breaks</entry>
							<entry>This controls how many HTML breaks are inserted for every new line in the edited text. The default is 2, but some people prefer one line to equal one line, in which case this can be set to 1.</entry>
						</row>
						<row>
							<entry>Use versioning</entry>
							<entry>When this is switched off, version backup and diff is not available. This is only recommended where disk space is a real problem.</entry>
						</row>
						<row>
							<entry>Allow HTML</entry>
							<entry>When this option is switched on, HTML markup will not be ignored, it will be output as HTML.</entry>
						</row>
						<row>
							<entry>Allow back-tick WikiNames</entry>
							<entry>When this option is on, back-tick wiki-naming is allowed. With the option off, only traditional CamelCaps naming can be used.</entry>
						</row>
						<row>
							<entry>Force the setting of username</entry>
							<entry>When this option is on, users must set a username before they are allowed to edit topics</entry>
						</row>
						<row>
							<entry>Format-Lexer, Layout-Lexer and Link-Lexer</entry>
							<entry>These are set as fully qualified Java class names. The format lexer is the class responsible for tokenizing the user input and formatting it approprtiately - e.g. bold, and italics, the layout lexer takes care of lists and tables. The link lexer is responsible for the automagic linking as described earlier. It is possible to write a single lexer that does both, in which case the link lexer should be set to "null'. More details on this can be found later in this manual.</entry>
						</row>
						<row>
							<entry>Upload directory</entry>
							<entry>This can either be a relative or an absolute path. If it is relative, it will be created relative to the <filename>{installdir}</filename>. <emphasis>Ensure  that if you are using Windows, you specify the path with Unix-style forward slashes ("/"), not the DOS-style backslashes. </emphasis>The directory specified by the path will be used to store file upload attachments.
							</entry>
						</row>
						<row>
							<entry>File upload size limit</entry>
							<entry>This is the maximum allowable file-size in KB, any larger files will be rejected on upload.</entry>
						</row>
						<row>
							<entry>Attachment type</entry>
							<entry>There are two ways to deliver attachments to users. "Inline" will ask the browser to open the file itself, e.g. with a plug-in as for Adobe Acrobat. It will do this in a new window. "Attachment" asks the browser to show a download prompt immediately. It really depends on how you use attachments as to which is preferable for your users. It is also very much up to the browser how it deals with the requests, so behaviour will differ across different browsers.</entry>
						</row>
						<row>
							<entry>File-system directory</entry>
							<entry>In flat-file mode, this is where the files for the wiki topics will be stored.</entry>
						</row>
						<row>
							<entry>SMTP host, username and password</entry>
							<entry>This is the SMTP host name or IP address for the server that will handle outgoing email for topic change notifications. The username and password can be left blank for non-authenticating SMTP servers.</entry>
						</row>
						<row>
							<entry>Reply address</entry>
							<entry>This is the address that will appear in the reply-to field for Wiki email notifications.</entry>
						</row>
						<row>
							<entry>Persistence</entry>
							<entry>This is where the persistence mode can be set - either the default "Flat-File", or "Database" to use a MySQL database as the back end. If you select "Database", you will be presented with further fields in which to enter the JDBC database driver name, the database name and a user and password. VQWiki ships with the MM MySQL driver and its name will be the default value. See the chapter on MySQL for more information on setting this up.</entry>
						</row>
						<row>
							<entry>Closed user group?</entry>
							<entry>Normally, a wiki has no closed user group, but anybody is free to enter/modify text. However, in a controlled environment (e.g. inside a company) it may be a requirement, to clearly distinguish the people. Then you can have a closed user group. The wiki can query a data source for the names of that user group. With the selector, you select the type of data source you want to use. Currently, only LDAP is supported. Note: You must have "use versioning" and "Force the setting of username" switched on to see the effects.</entry>
						</row>
						<row>
							<entry>Java Factory</entry>
							<entry>This is the java factory, which is used for the user group. For LDAP choose "com.sun.jndi.ldap.LdapCtxFactory".</entry>
						</row>
						<row>
							<entry>URL</entry>
							<entry>The URL to connect to the data source server. For LDAP choose "ldap://your.ldap.server:389".</entry>
						</row>
						<row>
							<entry>Username</entry>
							<entry>The username you need to connect to the data source. Can be left empty.</entry>
						</row>
						<row>
							<entry>Password</entry>
							<entry>The password you need to connect to the data source. Can be left empty.</entry>
						</row>
						<row>
							<entry>Search-String</entry>
							<entry>The basic query string you need to query the datasource. For LDAP choose something like "ou=users,dc=yourcompany,dc=com".</entry>
						</row>
						<row>
							<entry>Search restrictions</entry>
							<entry>If you want to add additional restrictions to the search. Use a comma separated list. For LDAP you could do: "objectClass=person"</entry>
						</row>
						<row>
							<entry>Name of field of user-id</entry>
							<entry>The name of the field of the user identifier in the datasource. In LDAP it usually is "uid".</entry>
						</row>
						<row>
							<entry>Name of field of full name</entry>
							<entry>The name of the field of the full name in the datasource. In LDAP it usually is "cn".</entry>
						</row>
						<row>
							<entry>Name of field of email address</entry>
							<entry>The name of the field of the email address in the datasource. In LDAP it usually is "mail".</entry>
						</row>
						<row>
							<entry>Detailview of user / author</entry>
							<entry>A snippet of HTML code, which is shown on a wiki page to give more details about the author. The text is HTML code plus some placeholders. The placeholders are formatted like "@@cn@@" and are filled with the apropriate field (in the example: the field "cn") from the data source.</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
			<para>
				Following the settings are a number of other functions.
			</para>
			<table>
				<title>Admin Console Functions</title>
				<tgroup cols="2">
					<tbody>
						<row>
							<entry>Refresh Search Index</entry>
							<entry>This forces the flat-file mode search indexer to run. As mentioned earlier, the indexer is run automatically at the interval specified above.</entry>
						</row>
						<row>
							<entry>Purge Deleted Topics</entry>
							<entry>This will delete any topics that contain only the word "delete".</entry>
						</row>
						<row>
							<entry>Clear Edit Lock on Topic</entry>
							<entry>To use this, enter a topic name and click the "Go" button, any lock that is held on the topic will be cleared.</entry>
						</row>
						<row>
							<entry>Read-only Topics</entry>
							<entry>Use this section to add and remove topics that should be read-only</entry>
						</row>
						<row>
							<entry>Add virtual wiki</entry>
							<entry>Entering a new virtual wiki name and clicking add will register the virtual wiki of that name. Note that a servlet mapping must be added to the web-app descriptor as well. This is covered later in this manual.</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
			<section>
				<title>Admin Password Recovery</title>
				<para>If you misplace the admin password, you can force VQWiki to generate a new one and display it to you on the first topic browsed to (as with initial installation). Use a text editor to edit the <filename>{installdir}/WEB-INF/classes/jmwiki.properties</filename> file (or another location if you have overridden the default) and change the key-value pair that reads <computeroutput>firstuse=false</computeroutput> to <computeroutput>firstuse=true</computeroutput>. Restart the application context or the application server and browse to StartingPoints. You will be shown the new admin password.</para>
			</section>
		</chapter>
		<chapter>
			<title>Configuration "Under the Hood"</title>
			<para>
				The Admin Console writes to a properties file called <filename>jmwiki.properties</filename>. This file along with the other configuration files will be by default in <filename>{installdir}/WEB-INF/classes</filename>. The files must be in the root of the classpath becuase they are searched for using the ClassLoader. The VQWiki environment also has hard-coded default values for the properties to ensure that it will always start regardless of whether or not a properties file is available. Here's a summary of all the resource and property files:
			</para>
			<table>
				<title>Configuration Files</title>
				<tgroup cols="2">
					<thead>
						<row>
							<entry>File</entry>
							<entry>Purpose/Contents</entry>
						</row>
					</thead>
					<tbody>
						<row>
							<entry>jmwiki.properties</entry>
							<entry>System settings</entry>
						</row>
						<row>
							<entry>ApplicationResources.properties</entry>
							<entry>Locale-specific language strings. This includes the mail messages to be sent on email notification of topic changes</entry>
						</row>
						<row>
							<entry>linking.properties</entry>
							<entry>Mapping of automagic link syntax to URLs. The link system is extensible, e.g. you can add an entry to make cvs:MyFile link to your local WebCVS.</entry>
						</row>
						<row>
							<entry>mime.types</entry>
							<entry>MIME type mapping by file extension for attachment delivery to browsers. This is actually just the standard Apache mapping.</entry>
						</row>
						<row>
							<entry>log4j.properties</entry>
							<entry>The Apache Jakarta Log4J properties file. This controls the logging output level. It should be set to WARN, but I sometimes forget and leave it set to DEBUG before releasing.</entry>
						</row>
						<row>
							<entry>pseudotopics.properties</entry>
							<entry>This contains key-value mapping of topic names that are not really editable topics to redirect URLs to carry out special actions, e.g. RecentChanges</entry>
						</row>
						<row>
							<entry>actions.properties</entry>
							<entry>This contains key-value mapping of action names to class names of classes that implement jmwiki.WikiAction. Plugins place mappings in this file.</entry>
						</row>
					</tbody>
				</tgroup>
			</table>
			<para>
				There are some application servers that don't like files being written to when they are resources. There is also the case that you may want to keep your properties file intact between Wiki upgrades. In these instances you can set a location for the properties file by adding an environment entry named "propertiesFile" to the web-app descriptor for your Wiki context, e.g.:
			</para>
			<para>
				<computeroutput><![CDATA[
        <Context path="/jmwiki" docBase="jmwiki-2.0" debug="0" >
        	<!-- the rest of your context information -->
        	<env-entry>
        	  <description>VQWiki propertiesFile</description>
        	  <env-entry-name>propertiesFile</env-entry-name>
	         <env-entry-value>c:/myproperties</env-entry-value>
       	  <env-entry-type>java.lang.String</env-entry-type>
	    </env-entry>
        </Context>
]]></computeroutput>
			</para>
		</chapter>
		<chapter>
			<title>Customising the Logo</title>
			<para>
The custom logo image feature works as follows:
</para>
			<para>
By default, we use <filename>{installdir}/images/logo.jpg</filename>. If the user specifies the URL of an alternate image in the deployment metadata, that image will be used instead.  In this case, a "Powered by VQWiki" image will be displayed on the footer of all pages that use the custom logo.
</para>
			<para>
E.g., in Tomcat <filename>server.xml</filename>, it would look like this (note the override attribute):
</para>
			<para>
				<computeroutput><![CDATA[
        <Context path="" docBase="jmwiki-classic" debug="0" >
		<env-entry>
         		<description>logoImageName</description>
		         <env-entry-name>logoImageName</env-entry-name>
		         <env-entry-value>/images/tomcat-power.png</env-entry-value>
		         <env-entry-type>java.lang.String</env-entry-type>
		    </env-entry>                      
		</Context>
]]></computeroutput>
			</para>
			<para>
or
</para>
			<para>
				<computeroutput><![CDATA[

          <Context path="/jmwiki/mikewiki" docBase="jmwiki-classic" debug="0" >
          	<Environment name="logoImageName" type="java.lang.String"
                      value="http://images.sourceforge.net/head_bg_new.gif" override="false"/>
	      </Context>
	      ]]></computeroutput>
			</para>
			<para>
The index page and admin console still display the VQWiki logo, as always.
</para>
		</chapter>
		<chapter>
			<title>Persistence - The Default File-System</title>
			<para>
				VQWiki's major goal is to be as easy to deploy as possible, i.e. drop the WAR, start the server. It is for this reason that the default file system exists. The principles are very simple, but so is WikiWikiWeb, so it works:
</para>
			<itemizedlist>
				<listitem>
					<para>By default, the file-system is set up in the user's home directory, in a sub-directory named "jmwiki". This location can be changed from the admin console.</para>
				</listitem>
				<listitem>
					<para>Every topic gets written to one text file named as the topic with a "txt" extension</para>
				</listitem>
				<listitem>
					<para>Versioning gets written to files with a timestamp in the filename in a versions sub-directory</para>
				</listitem>
				<listitem>
					<para>Locking is maintained by the creation of files named as the topic with a "lock" extension</para>
				</listitem>
				<listitem>
					<para>Usernames, subscriptions and recent changes are serialized via JSX<footnote>
							<para>Java Serialization to XML <ulink url="http://objectlight.com/">http://objectlight.com/</ulink>
							</para>
						</footnote> to XML files</para>
				</listitem>
			</itemizedlist>
			<para>If you require higher performance than you would expect from the above system, that's where the MySQL database mode as described in the next chapter comes in.</para>
		</chapter>
		<chapter>
			<title>Persistence - The MySQL Database Mode</title>
			<para>
				Using MySQL as a back end turns VQWiki into a very quick Wiki indeed. The development goal is still drop-and-go, so VQWiki will build its own tables when you first connect it to a database: no scripts to run (except for creating the database of course - it has to connect to something).
			</para>
			<para>
The default settings are for a database called "jmwiki" with a user called "jmwiki" with
password "jmwiki". If you were to use those settings, and the MySQL server is running on
the same machine as the web container, the following two statements will prepare the database:
</para>
			<para>
				<computeroutput>
create database jmwiki;</computeroutput>
			</para>
			<para>
				<computeroutput>
grant all on jmwiki.* to jmwiki@localhost identified by 'jmwiki';
</computeroutput>
			</para>
			<para>
The easiest way to do this is to find your MySQL binary - on Windows this is called "mysql.exe"
and is in your MySQL bin directory. On Linux it's just called "mysql" and is usually in
/usr/bin. If you run the mysql binary, you'll be presented with the mysql prompt, at which you
can just copy and paste in the statements above.
</para>
			<para>
Obviously, you may need to change the hostname from <systemitem>localhost</systemitem> to something else if you are running MySQL on a different machine to the one running the database, or if you have set MySQL to bind to an address
other than the localhost loopback, e.g. if MySQL is bound to a network card.
</para>
		</chapter>
		<chapter>
			<title>Edit Locks</title>
			<para>
				When a user clicks the edit link, an exclusive lock is set on the topic they are editing. While this lock is present, any other users attempting to edit the topic will receive an error message asking them to try again later. This prevents conflicts occuring where one user inadvertently overwriters another user's changes.
			</para>
			<para>
				If a user spends longer editing a topic than specified in the edit-lock timeout setting, the lock will be revoked when another user edits that topic. If the user who originally obtained the lock attempts to save, they will receive an error message telling them that their lock has expired. It is then up to user whose lock expired to merge the changes they took too long over into the new user's changes, once that user has finished editing their version.
			</para>
			<para>
				Of course, if a user edits beyond their timeout and noone else tries to edit the same topic during that time, they may continue to save as normal. On an average size Wiki, this is almost always the case.
			</para>
			<para>
			The administrator can unlock a topic manually by going to the &quot;WikiLockList&quot; topic. This topic displays a list of current locks with an "unlock" link beside each one. If you have not already logged in as an administrator, you will be prompted to log in upon clicking an unlock link.
			</para>
		</chapter>
		<chapter>
			<title>Lexers</title>
			<para>
				As mentioned earlier, the format lexer is the class responsible for tokenizing the user input and formatting it appropriately - e.g. bold, italics, lists and tables. The link lexer is responsible for the automagic linking as described earlier. It is possible to write a single lexer that does both, in which case the link lexer should be set to "null'.			</para>
			<para>
				VQWiki is distributed with three default lexers: <systemitem>jmwiki.lex.FormatLex</systemitem> and <systemitem>jmwiki.lex.LinkLex</systemitem> are designed to work together and should be adequate for most purposes.
</para>
			<para>
 A third lexer <systemitem>jmwiki.lex.FritzLex</systemitem> (written by Fritz Freiheit) does not require a separate link lexer, so the link lexer should be set to "null" in the admin console to use it. This lexer supports a wider range of heading styles than the default lexers.
			</para>
			<para>
 Another lexer shipped with VQWiki duplicates the syntax used by the popular Mediawiki software (see <ulink url="http://meta.wikimedia.org/wiki/Help:Editing">http://meta.wikimedia.org/wiki/Help:Editing</ulink>).  To use this lexer the Format lexer value should be set to jmwiki.lex.MediaWikiSyntax, the layout lexer should be set to jmwiki.lex.MediaWikiHTML, and the link lexer should be set to "null".
			</para>
			<para>
				The lexers that come with VQWiki are generating using the JLex<footnote>
					<para>JLex lexical analyser generator <ulink url="http://www.cs.princeton.edu/%7Eappel/modern/java/JLex/">http://www.cs.princeton.edu/%7Eappel/modern/java/JLex/</ulink>
					</para>
				</footnote> tool. However, you can write your lexer in any way you choose - so long as it implements the  <systemitem>jmwiki.lex.Lexer</systemitem> interface.
			</para>
		</chapter>
		<chapter>
			<title>Extensible Lexers</title>
			<para>
				From version 2.4.0 onwards, VQWiki supports external lexers. These lexers are triggered from the standard lexers using special markup. As an example, VQWiki is supplied with jmwiki.lex.JavaLex which uses the java2html<footnote>
					<para>Java2Html freeware Java source formatter <ulink url="http://www.java2html.de">http://www.java2html.de</ulink>
					</para>
				</footnote> library to format Java source code into pretty HTML. To see it in action, try entering the following into a Wiki topic:
			</para>
			<para>
				<computeroutput><![CDATA[
				[<java>]
					class Test{
						public void test();
					}
				[</java>]
			]]></computeroutput>
			</para>
			<para>
				You should see neatly formatted Java source code. The special tag format asks VQWiki to process all the text inside the tags using the class named as the value for "java" in the <filename>{installdir}/WEB-INF/classes/externallex.properties</filename> file. The default entry in this file is: <computeroutput>java=jmwiki.lex.JavaLex</computeroutput>.
			</para>
			<para>
				To write your own external lexer, write a class that implements <classname>jmwiki.lex.ExternalLex</classname> interface (it's only one method) and put an entry with an appropriate tag name in the externallex.properties file.
			</para>
			<para>
E.g. you might write a class called jmwiki.mylexers.CLex for formatting C code. You could then make an entry in the properties file of the form <computeroutput>c=jmwiki.mylexers.CLex</computeroutput>. Anything between the tags <computeroutput><![CDATA[[<c>][</c>]]]></computeroutput> would then be passed to the <methodname>process( String text )</methodname> method in the class <classname>jmwiki.mylexers.CLex</classname>.
			</para>
		</chapter>
		<chapter>
			<title>External Links - xx: Entries</title>
			<para>By default, VQWiki supports entries to make reference to the original C2 WikiWikiWeb, the Meatball Wiki and individual Microsoft Knowledge Base articles. The shorthand for these all take the form <computeroutput>prefix:detail</computeroutput>
			</para>
			<para>You can add new external links by editing the file <filename>{installdir}/WEB-INF/classes/linking.properties</filename>. A comment in the file explains the straightforward syntax. In the case of the C2 Wiki, the entry is <computeroutput>c2=http://c2.com/cgi/wiki?${url}</computeroutput>. The <computeroutput>${url} </computeroutput> keyword is expanded to whatever the user puts after the colon when they create the link, e.g if they put c2:StartingPoints, <computeroutput>${url} </computeroutput> will be expanded to "StartingPoints" creating the complete URL <computeroutput>http://c2.com/cgi/wiki?StartingPoints</computeroutput>
			</para>
		</chapter>
		<chapter>
			<title>Auto-installing Plugins</title>
			<para>
				This system provides a way to distribute additional Wiki functionality as "plugins". 
			</para>
			<orderedlist numeration="arabic">
				
				
				<listitem>
					<para>
					Add a plugins directory to {wikihome}. 
					&nbsp;&nbsp;Move MyPluginFile.zip into the directory {wikihome}/plugins.
					</para>
				</listitem>
				
				<listitem>
					<para>
					Shut down Tomcat if it is running.
          </para>
				</listitem>
				
				<listitem>
					<para>
					Start Tomcat
          </para>
				</listitem>
			
			</orderedlist>
			<section>
				<title>Plugins</title>
				<para>
				If you wish to distribute an external lexer as a plugin, or add new actions, it is possible to package them as one zip with a single XML file to describe the external lex properties entry. If the zip is placed in the <filename>{wikihome}/plugins</filename>, its file structure will be automatically unzipped into the <filename>{installdir}</filename> on startup. If the plugin filename is "myplugin", then a file called <filename>myplugin.xml</filename> should be placed inside the zip in the <filename>WEB-INF/classes</filename> path.
			</para>
				<para>
				The <filename>myplugin.xml</filename> file can contain an entry of the form 
			</para>
				<para>
					<computeroutput><![CDATA[
				<plugin>
				  <external-lex tag="mytag" class="mypackage.MyLexClass"/>
				  <action name="myaction" class="mypackage.MyAction" pseudotopic="MyTopic"/>
				</plugin>
			 ]]></computeroutput>
				</para>
				<para>
				This entry will be translated into an entry in <filename>externallex.properties</filename> and an entry in
				<filename>actions.properties</filename>. If a URL is requested from the Wiki controller with an "action" parameter, the value
				of the action parameter will be looked up as the action name. If a mapping exists, the action class will be instantiated and
				the HTTP request and response will be forwarded to the action. E.g. <filename>http://myserver/wiki/jsp/Wiki?action=myaction</filename>
				will trigger the action in the example above.
			</para>
				<para>
			  The pseudotopic entry on the action element is optional. If present it will associate a pseudotopic with the action. In the
				case above, going to the topic "MyTopic" will trigger the action, e.g. by navigating to <filename>http://myserver/wiki/jsp/Wiki?MyTopic</filename>. 
				This is useful if you wish to have the action triggered from a LeftMenu entry for example.
			</para>
				<para>
			  So the entire zip file structure for <filename>myplugin.zip</filename> should look like:
				</para>
				<itemizedlist>
					<listitem>
						<para>WEB-INF/classes/myplugin.xml</para>
					</listitem>
				</itemizedlist>
				<itemizedlist>
					<listitem>
						<para>WEB-INF/classes/mypackage/MyLexClass.class</para>
						<para>WEB-INF/classes/mypackage/MyAction.class</para>
					</listitem>
				</itemizedlist>
			</section>
		
		</chapter>
	
	
	</book>
</set>
